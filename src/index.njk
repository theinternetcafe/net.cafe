---
pagination:
  data: site.events
  size: 6
  alias: events
---
<html>
  <head>
    <title>{{ site.title }}</title>
    <meta property="og:title" content="{{ site.title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ site.url }}" />
    <meta
      property="og:image"
      content="https://imagedelivery.net/2XOKk6tqcY0Sf5Iqe-LStg/8db64013-2d89-4029-b218-7196b516b500/public"
    />
    <meta property="og:description" content="{{ site.description }}" />
    <meta name="theme-color" content="#0060a9" />

    <!-- Include this to make the og:image larger -->
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="stylesheet" href="/css/style.css" />
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const audio1 = document.getElementById('radio-stream-1');
        const audio2 = document.getElementById('radio-stream-2');
        const playButton = document.getElementById('play-button');
        const refreshButton = document.getElementById('refresh-button');
        const listenersEl = document.getElementById('listeners-count');
        const titleEl = document.getElementById('stream-title');
        const streamUrl = 'https://radio.net.cafe/stream.mp3';
        let hasAutoPlayed = false;
        let currentAudio = audio1;
        let backupAudio = audio2;
        let isPlaying = false;
        
        if (!audio1 || !audio2 || !playButton) {
          console.error('Audio elements not found');
          return;
        }
        
        // Set initial volumes
        audio1.volume = 1;
        audio2.volume = 0;
        
        // Seamless stream restart with crossfade
        function restartStream() {
          if (!isPlaying) return;
          
          // Load fresh stream in the backup (which is currently silent)
          backupAudio.src = streamUrl + '?t=' + Date.now();
          backupAudio.load();
          backupAudio.volume = 0;
          
          // Start playing backup
          backupAudio.play().then(() => {
            // Crossfade from current to backup
            const fadeSteps = 20;
            const fadeInterval = 50; // ms
            let step = 0;
            
            const fade = setInterval(() => {
              step++;
              const progress = step / fadeSteps;
              currentAudio.volume = Math.max(0, 1 - progress);
              backupAudio.volume = Math.min(1, progress);
              
              if (step >= fadeSteps) {
                clearInterval(fade);
                currentAudio.pause();
                currentAudio.volume = 0;
                backupAudio.volume = 1;
                
                // Swap roles for next refresh
                const temp = currentAudio;
                currentAudio = backupAudio;
                backupAudio = temp;
              }
            }, fadeInterval);
          }).catch(e => console.log('Crossfade failed:', e));
        }
        
        // Play/Pause button
        playButton.addEventListener('click', function() {
          if (!isPlaying) {
            currentAudio.play().catch(e => console.log('Play error:', e));
            isPlaying = true;
            playButton.textContent = '⏸';
            playButton.setAttribute('aria-label', 'Pause radio');
          } else {
            currentAudio.pause();
            backupAudio.pause();
            isPlaying = false;
            playButton.textContent = '▶';
            playButton.setAttribute('aria-label', 'Play radio');
          }
        });
        
        // Refresh button
        if (refreshButton) {
          refreshButton.addEventListener('click', function() {
            restartStream();
          });
        }
        
        // Auto-restart every 5 minutes to prevent buffer drift
        setInterval(function() {
          if (isPlaying) {
            console.log('Auto-refreshing stream');
            restartStream();
          }
        }, 5 * 60 * 1000);
        
        // Fetch and update stream metadata
        async function updateMetadata() {
          try {
            const response = await fetch('https://radio.net.cafe/status-json.xsl');
            const data = await response.json();
            const source = data.icestats.source;
            
            if (listenersEl && source.listeners !== undefined) {
              listenersEl.textContent = source.listeners + ' listener' + (source.listeners !== 1 ? 's' : '');
            }
            
            if (titleEl && source.title) {
              titleEl.textContent = source.title;
            }
            
            // Auto-play if stream is live
            if (!hasAutoPlayed && source.title && !isPlaying) {
              currentAudio.play().then(() => {
                isPlaying = true;
                playButton.textContent = '⏸';
                playButton.setAttribute('aria-label', 'Pause radio');
                hasAutoPlayed = true;
              }).catch(() => {
                console.log('Autoplay blocked');
              });
            }
          } catch (e) {
            console.log('Metadata fetch error:', e);
          }
        }
        
        // Update metadata every 10 seconds
        updateMetadata();
        setInterval(updateMetadata, 10000);
      });
    </script>
  </head>
  <body>
    <div id="inner">
      <div id="logobox-top">
        <img
          class="logo-top light"
          src="https://imagedelivery.net/2XOKk6tqcY0Sf5Iqe-LStg/a619d3a3-d980-4ee8-2881-212bef6b2e00/public"
        /><img
          class="logo-top dark"
          src="https://imagedelivery.net/2XOKk6tqcY0Sf5Iqe-LStg/d56548ca-83c5-40ad-9d94-af80fabe2200/public"
        />
      </div>
      <div id="column-1" class="column">
        <div class="column-body">
          <span class="title">CONNECT</span>
          <hr />
          {% for event in events %} {% if event.link %}
          <a href="{{ event.link }}">
            {% endif %}
            <p class="event">
              <b>{{ event.name }}</b
              ><br />
              {{ event.when }}
            </p>
            {% if event.link %}
          </a>
          {% endif %} {% endfor %}
          <div class="column-footer"></div>
          <span class="title">RADIO</span>
          <hr />
          <div class="radio-player">
            <audio id="radio-stream-1" preload="metadata">
              <source src="https://radio.net.cafe/stream.mp3" type="audio/mpeg">
            </audio>
            <audio id="radio-stream-2" preload="metadata">
              <source src="https://radio.net.cafe/stream.mp3" type="audio/mpeg">
            </audio>
            <div class="player-controls">
              <button id="play-button" aria-label="Play radio">▶</button>
              <button id="refresh-button" aria-label="Refresh stream" title="Refresh stream">↻</button>
            </div>
            <p class="stream-info">
              <span id="listeners-count">—</span><br>
              <span id="stream-title" class="stream-title"></span>
            </p>
          </div>
          <div class="column-footer"></div>
        </div>
      </div>
      <div id="column-2" class="column">
        <div id="logobox">
          <img
            class="logo light"
            src="/img/internet-cafe.svg"
          />
          <img
            class="logo dark"
            src="/img/internet-cafe-dark.svg"
          />
        </div>
        <div class="column-body">
          <span class="title">BLOGZ</span>
          <hr />
          {% for post in collections.posts %}
          <a href="{{ post.url }}">
            <p class="event">
              <b>{{ post.data.title }}</b
              ><br />
              Author: {{ post.data.author }}
            </p>
          </a>
          {% endfor %}
          <div class="column-footer"></div>
        </div>
      </div>
      <div id="column-3" class="column">
        <div class="column-body">
          <span class="title">PARTNERZ</span>
          <hr />
          <a href="https://hackimon.com"
            ><img
              class="partner-logo light"
              src="/img/hackimon.svg" /><img
              class="partner-logo dark invert"
              src="/img/hackimon.svg"
          /></a>
          <a href="https://tracerats.org"
            ><img
              class="partner-logo light"
              src="/img/tracerats-skull-text.svg" /><img
              class="partner-logo dark invert"
              src="/img/tracerats-skull-text.svg"
          /></a>
          <a href="https://dec0de.xyz"
            ><img
              class="partner-logo light"
              src="/img/dec0de-xyz.png" /><img
              class="partner-logo dark invert"
              src="/img/dec0de-xyz.png"
          /></a>
          <a href="https://cloud-fortress.com"
            ><img
              class="partner-logo light"
              src="/img/cloud-fortress-logo.png" /><img
              class="partner-logo dark invert"
              src="/img/cloud-fortress-logo.png"
          /></a>
          <div class="column-footer"></div>
          <span class="title">DONATE</span>
          <hr />
          <a href="https://paypal.me/theinternetcafe"
            ><img
              class="partner-logo"
              src="https://imagedelivery.net/2XOKk6tqcY0Sf5Iqe-LStg/8fde34d6-e655-4d4b-f7e9-f30bc8cbe900/public" />
          </a>
          <div class="column-footer"></div>
        </div>
      </div>
    </div>
    <div id="footer">
      <span class="copyleft">&copy;</span
      ><span
        >2024 Internet Cafe -&nbsp;
        <a href="https://github.com/theinternetcafe/code-of-conduct"
          >Code Of Conduct</a
        ></span
      >
    </div>
  </body>
</html>
